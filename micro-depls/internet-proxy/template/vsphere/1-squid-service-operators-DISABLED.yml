- type: replace
  path: /instance_groups/name=system-internet-relay/jobs/-
  value:
    name: squid
    release: squid
    properties:
      acl: |
        #debug_options ALL,7

        #--- Accepted inbound connections
        #acl localnet src 10.0.0.0/8     # RFC 1918 possible internal network should not allow from intranet
        #acl localnet src 172.16.0.0/12  # RFC 1918 possible internal network
        acl localnet src 192.168.0.0/16 # RFC 1918 possible internal network

        acl localnet src fc00::/7       # RFC 4193 local private network range
        acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

        acl SSL_ports port 443
        acl Safe_ports port 80          # http
        acl Safe_ports port 443         # https
        acl CONNECT method CONNECT

        #--- Deny requests to unsafe ports
        http_access deny !Safe_ports

        #--- Deny CONNECT to other than secure SSL ports
        http_access deny CONNECT !SSL_ports

        #--- Allow inbound from local networks
        http_access allow localnet

        #--- Relay to a corporate internet proxy
        cache_peer ((target-proxy-host)) parent ((target-proxy-port)) 0 proxy-only no-query ((target-proxy-auth))
        never_direct allow all