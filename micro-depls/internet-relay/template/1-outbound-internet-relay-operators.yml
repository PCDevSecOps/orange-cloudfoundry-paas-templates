#--- Set up squid
- type: replace
  path: /releases/-
  value:
    name: squid
    version: 1.0.1 #specify version here (not yet COA managed)

- type: replace
  path: /instance_groups/name=internet-relay/jobs/-
  value:
    name: squid
    release: squid
    properties:
      acl: |
        #debug_options ALL,7
        #dns_nameservers 1.1.1.1
        
        #accepted inbound connections ----------------------------
        #acl localnet src 10.0.0.0/8     # RFC 1918 possible internal network should not allow from intranet
        #acl localnet src 172.16.0.0/12  # RFC 1918 possible internal network
        acl localnet src 192.168.0.0/16 # RFC 1918 possible internal network
        acl localnet src ((/secrets/intranet_interco_2/to_intranet))/32 # transitional: authorize TEMPORARLY EIN (intranet2) machine on Proxy - delete after v41

        
        acl localnet src fc00::/7       # RFC 4193 local private network range
        acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines

        #denied outbound connections ---------------------------- (no intranet access posssible with the proxy)
        acl localdest dst 10.0.0.0/8     # RFC 1918 possible internal network should not allow access to intranet
        acl localdest dst 172.16.0.0/12  # RFC 1918 possible internal network
        acl localdest dst 192.168.0.0/16 # RFC 1918 possible internal network

        acl SSL_ports port 442 443
        acl Safe_ports port 80          # http
        acl Safe_ports port 443         # https
        acl Safe_ports port 5281        # elk 
        acl Safe_ports port 1025-65535  # Unregistered ports
        acl CONNECT method CONNECT

        # Deny requests to unsafe ports
        http_access deny !Safe_ports

        # Deny CONNECT to other than secure SSL ports
        http_access deny CONNECT !SSL_ports

        # permit inbound from local networks
        http_access allow localnet
        
        # this is set by the bosh release ==>  http_access deny all

