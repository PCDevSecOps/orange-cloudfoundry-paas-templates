
## https://docs.gitlab.com/charts/installation/secrets.html#manual-secret-creation-optional
## https://docs.gitlab.com/charts/installation/secrets.html#registry-authentication-certificates


- type: replace
  path: /variables?/-
  value:
    name: registry
    type: certificate
    options:
      common_name: gitlab-issuer
      is_ca: true

- type: replace
  path: /variables?/-
  value:
    name: gitlab-registry-secret
    type: password



- type: replace
  path: /instance_groups/name=k8s-helm-addons/jobs/name=action/properties/actions/-
  value:
    type: secret
    name: gitlab-registry-secret
    namespace: gitlab
    data:
    - name: registry-auth.key
      value: '((registry.private_key))'
    - name: registry-auth.crt
      value: '((registry.certificate))'


- type: replace
  path: /instance_groups/name=k8s-helm-addons/jobs/name=action/properties/actions/-
  value:
    type: secret
    name: gitlab-registry-httpsecret
    namespace: gitlab
    data:
    - name: secret
      value: ((gitlab-registry-secret))
