- type: replace
  path: /instance_groups/name=cfcr-helm-addons/jobs/name=action/properties/actions/-
  value:
    type: ingress
    name: gitlab-ingress
    namespace: gitlab
    definition:
      spec:
        rules:
        - host: gitlab-gitlab.((env_pf)).((/secrets/cloudfoundry_ops_domain))
          http:
            paths:
            - backend:
                serviceName: gitlab-unicorn
                servicePort: 8181
              path: /
            - backend:
                serviceName: gitlab-unicorn
                servicePort: 8080
              path: /admin/sidekiq
        tls:
        - secretName: release-gitlab-tls
          hosts:
          - gitlab-gitlab.((env_pf)).((/secrets/cloudfoundry_ops_domain))


- type: replace
  path: /instance_groups/name=cfcr-helm-addons/jobs/name=action/properties/actions/-
  value:
    type: ingress
    name: registry-ingress
    namespace: gitlab
    annotations:
    - name: "ingress.kubernetes.io/protocol"
      value: "http"
    definition:
      spec:
        rules:
        - host: registry-gitlab.((env_pf)).((/secrets/cloudfoundry_ops_domain))
          http:
            paths:
            - backend:
                serviceName: gitlab-registry
                servicePort: 5000
              path: /
        tls:
        - secretName: release-registry-tls
          hosts:
          - registry-gitlab.((env_pf)).((/secrets/cloudfoundry_ops_domain))

