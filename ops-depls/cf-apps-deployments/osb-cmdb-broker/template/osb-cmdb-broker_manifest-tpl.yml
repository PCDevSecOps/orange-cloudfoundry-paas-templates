---
applications:
  - name: osb-cmdb-broker
    memory: 2GB
    stack: cflinuxfs3
    host: osb-cmdb-broker
    domain: (( grab secrets.cloudfoundry.system_domain ))
    instances: 1
    path: osb-cmdb.jar
    timeout: 180
    buildpack: java_buildpack
    env:
      # broker basic auth user
      spring.security.user.name: (( grab secrets.osb-cmdb-broker.name ))
      # broker basic auth password. Declaration controlled in credhub-var-broker-password.json dynamically file
      spring.security.user.password: "((broker-password))" # credhub namespaced into /${root_deployment}/cf-apps-deployments/${deployment}
      # broker basic auth password


      logging.level.org.springframework.cloud.appbroker: debug
      logging.level.org.springframework.cloud.appbroker.deployer.cloudfoundry: debug
      logging.level.org.springframework.cloud.servicebroker: debug # for incoming OSB API traces
      logging.level.cloudfoundry-client: debug
      logging.level.cloudfoundry-client.operations: debug

#      DEBUG: true # Springboot debugging mdoe when context fails to load
      logging.level.org.springframework.cloud.appbroker.autoconfigure: info #Dynamic catalog logging

      # CloudFoundry CC api host
      spring.cloud.appbroker.deployer.cloudfoundry.api-host: "api.((/concourse-micro/main/cloudfoundry_system_domain))"
      spring.cloud.appbroker.deployer.cloudfoundry.api-port: 443
      spring.cloud.appbroker.deployer.cloudfoundry.username: "coa-cf" # credential_leak_validated. no yet credhub secret for it.
      spring.cloud.appbroker.deployer.cloudfoundry.password: "((/concourse-micro/main/coa_cf_password))"
      spring.cloud.appbroker.deployer.cloudfoundry.default-org: (( grab secrets.osb-cmdb-broker.default-org || "system_domain" ))
      spring.cloud.appbroker.deployer.cloudfoundry.default-space: (( grab secrets.osb-cmdb-broker.default-space || "osb-cmdb-services" ))
      spring.cloud.appbroker.deployer.cloudfoundry.properties.memory: 1G
      spring.cloud.appbroker.deployer.cloudfoundry.properties.health-check: http
      spring.cloud.appbroker.deployer.cloudfoundry.properties.health-check-http-endpoint: health
      spring.cloud.appbroker.deployer.cloudfoundry.properties.health-check-timeout: 180

