- type: replace
  path: /instance_groups/name=k8s-helm-addons/jobs/name=action/properties/actions/-
  value:
    type: kubectl
    name: "openebs-cstor-sparse"
    cmd: "apply"
    options: ""
    content:
      apiVersion: storage.k8s.io/v1
      kind: StorageClass
      metadata:
        name: openebs-cstor-sparse
        annotations:
          storageclass.kubernetes.io/is-default-class: "true"
          openebs.io/cas-type: cstor
          cas.openebs.io/config: |
            - name: StoragePoolClaim
              value: "sparse-claim-auto"
            - name: VolumeMonitor
              enabled: "true"

      provisioner: openebs.io/provisioner-iscsi

- type: replace
  path: /instance_groups/name=k8s-helm-addons/jobs/name=action/properties/actions/-
  value:
    type: kubectl
    name: "sparse-claim-auto"
    cmd: "apply"
    options: ""
    content:
      apiVersion: openebs.io/v1alpha1
      kind: StoragePoolClaim
      metadata:
        name: sparse-claim-auto
        namespace: openebs
        annotations:
          # default PoolResourceRequests.value.cpu 100m
          cas.openebs.io/config: |
            - name: PoolResourceRequests
              value: |-
                  memory: 1Gi
                  cpu: 50m

            - name: PoolResourceLimits
              value: |-
                  memory: 4Gi
            - name: AuxResourceLimits
              value: |-
                  memory: 0.5Gi
                  cpu: 50m
            - name: Tolerations
              value: |-
                 t1:
                   key: persistence
                   operator: Exists
                   effect: NoExecute

      spec:
        name: sparse-claim-auto
        type: sparse
        maxPools: 3
        poolSpec:
          poolType: striped
          cacheFile: /var/vcap/store/openebs/sparse/sparse-claim-auto.cache
          overProvisioning: false

