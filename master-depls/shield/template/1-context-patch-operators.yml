#operators to adapt the community manifest to paas-templates context
#adapt deployment name

- type: replace
  path: /name
  value: shield

- type: replace
  path: /releases/name=bpm?
  value:
    name: bpm
    version: latest

- type: replace
  path: /releases/name=routing?
  value:
    name: routing
    version: latest


#adapt release, latest version for shield release
- type: replace
  path: /releases/name=shield
  value:
    name: shield
    version: latest
#add mysql agent for remote backups

- type: replace
  path: /instance_groups/name=shield/jobs/-
  value:
    name: agent-mysql
    release: shield


#adapt vm_types
- type: replace
  path: /instance_groups/name=shield/vm_type
  value: xlarge


#adapt persistent disk type
- type: replace
  path: /instance_groups/name=shield/persistent_disk_type
  value: xlarge



#adapt network
- type: replace
  path: /instance_groups/name=shield/networks/0/name
  value: tf-net-exchange

#adapt static_ips
- type: replace
  path: /instance_groups/name=shield/networks/name=tf-net-exchange/static_ips?
  value: ((static-ip))

- type: replace
  path: /variables/name=shield-tls/options/alternative_names/-
  value: ((static-ip))

#adapt release
- type: replace
  path: /releases/name=shield
  value:
    name: shield
    version: latest

#adapt log level
- type: replace
  path: /instance_groups/name=shield/jobs/name=shield-daemon/properties/log_level?
  value: ((log-level))

- type: replace
  path: /instance_groups/name=shield/jobs/name=shield-agent/properties/log_level?
  value: ((log-level))

#add route registrar for shield deployment
- type: replace
  path: /instance_groups/name=shield/jobs/-
  value:
    name: route_registrar
    release: routing
    properties:
      nats:
        machines: [ops-routing-nats] 
        password: ((/bosh-master/ops-routing/nats_password))
        user: nats
        port: 4222
      route_registrar:
        routes:
        - name: shield-webui
          port: 8080
          registration_interval: 20s
          uris:
          - ((shield-domain))
