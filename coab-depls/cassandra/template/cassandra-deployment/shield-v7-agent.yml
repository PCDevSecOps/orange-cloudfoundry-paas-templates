---

- path: /releases/name=shield?
  type: replace
  value:
    name: shield
    version: "7.0.8"
    url: https://github.com/gstackio/gk-shield-boshrelease/releases/download/v7.0.8/shield-7.0.8.tgz
    sha1: 4c6556f502ac84a95b5d25459b1764e245241b60

- path: /instance_groups/name=cassandra-seeds/jobs/name=shield-agent?
  type: replace
  value: &shield_agent_job
    name: shield-agent
    release: shield
    properties:
      autoprovision: "https://shield-webui.((/secrets/cloudfoundry_ops_domain))"
      provisioning_key: "((/secrets/shield_autoprovision_key))"
      jobs:
        cassandra_all_db_job-(name)-(index):
          store: cassandra_all_db_s3_obos
          retention: Short-term
          schedule: daily
          target: (deployment)/(name)-(index)/user-keyspaces
      retention-policies:
        Long-term: 180d
        Short-term: 20d
      schedules:
        DevSched: daily 4am
        daily: daily 2am
        monthly: 2st sunday at 0am
        weekly: sundays 9am
      stores:
        cassandra_s3_obos:
          name: cassandra_all_db_s3_obos
          plugin: scality
          config:
            access_key_id: "((/secrets/shield_obos_access_key_id))"
            bucket: "((/secrets/shield_obos_bucket_prefix))-cassandra-all-db"
            scality_host: storage.orange.com
            secret_access_key: "((/secrets/shield_obos_secret_access_key))"
            signature_version: '2'
      targets:
        user-keyspaces:
          name: (deployment)/(name)-(index)/user-keyspaces
          plugin: cassandra
          config:
            cassandra_host: (ip)
            cassandra_password: ((cassandra_admin_password))
            cassandra_datadir: /var/vcap/store/cassandra/((deployment_name))/data
            base_dir: /var/vcap/store/shield-backups
- path: /instance_groups/name=cassandra-servers/jobs/name=shield-agent?
  type: replace
  value: *shield_agent_job


