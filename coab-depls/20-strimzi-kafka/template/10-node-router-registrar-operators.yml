- type: replace
  path: /releases/-
  value:
    name: routing
    version: latest


- type: replace
  path: /instance_groups/name=worker/jobs/-
  value :
    name: route_registrar
    release: routing
    consumes: &consumes_properties
      nats:
        instances:
        - address: ops-routing-nats
        properties:
          nats:
            port: 4222
            user: nats
            password: ((/bosh-master/ops-routing/nats_password))
    properties: &registrar_properties
      route_registrar:
        routes:
        - name: ingress-((instance_id))-endpoint
          registration_interval: 60s
          port: 80 # traefik ingress controller
          uris:
          - inner-broker-((instance_id)).((/secrets/cloudfoundry_ops_domain))

- type: replace
  path: /instance_groups/name=master/jobs/-
  value :
    name: route_registrar
    release: routing
    consumes: *consumes_properties
    properties: *registrar_properties